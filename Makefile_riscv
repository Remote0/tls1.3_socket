#OPENSSL_DIR = /home/tuankiet/Documents/openssl-3.0-riscv
OPENSSL_DIR = /home/tuankiet/Documents/openssl-1.1.1-riscv

LIB = -lm
INCLUDE = -I$(OPENSSL_DIR)/include
LFLAGS = 
DEPS = ./crypto/*.h
#where is located the riscv openssl library
CRYPTO = $(OPENSSL_DIR)/libcrypto.a $(OPENSSL_DIR)/libssl.a


CC = riscv64-unknown-linux-gnu-gcc
CFLAGS = -Wall -g -Wl,-Bstatic

all: tls_server tls_client tls_nb_server demo_handshake

demo_handshake: demo_handshake.o
	$(CC) -o demo_handshake demo_handshake.o $(LFLAGS) $(LIB) $(CRYPTO)

tls_nb_server: tls_nb_server.o
	$(CC) -o tls_nb_server tls_nb_server.o $(LFLAGS) $(LIB) $(CRYPTO)

tls_server: tls_server.o
	$(CC) -o tls_server tls_server.o $(LFLAGS) $(LIB) $(CRYPTO)

tls_client: tls_client.o
	$(CC) -o tls_client tls_client.o $(LFLAGS) $(LIB) $(CRYPTO)

%.o: %.c $(DEPS)
	$(CC) $(CFLAGS) -c -o $@ $< $(INCLUDE)

clean:
	rm -f tls_server.o tls_client.o tls_server tls_client tls_nb_server tls_nb_server.o demo_handshake demo_handshake.o

#run
#make -f Makefile_riscv all

#build openssl for riscv64
#git clone git@github.com:openssl/openssl.git
#cd openssl
#./Configure linux64-riscv64 --cross-compile-prefix=riscv64-unknown-linux-gnu- -no-threads -no-engine -no-dso no-shared -no-asm -march=rv64imafdc -mabi=lp64d
#make 